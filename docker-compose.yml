version: "3.7"

networks:
    lookoutstationnet:
        name: lookoutstationnet
        driver: bridge

services:
    database:
        image: postgres:12
        container_name: lookoutstation-database
        hostname: database
        networks:
            - lookoutstationnet
        env_file:
            - configs/postgres.env

    redis:
      image: redis:latest
      container_name: lookoutstation-redis
      hostname: redis
      networks:
        - lookoutstationnet

    api:
        build: api/
        image: lookoutstation-api:latest
        container_name: lookoutstation-api
        hostname: lookoutstation-api
        networks:
            - lookoutstationnet
        ports:
            - "8080:8080"
        env_file:
            - configs/postgres.env
        environment:
            - FLASK_APP=main.py
        depends_on:
            - database

    emailer:
        build: emailer/
        image: lookoutstation-emailer:latest
        container_name: lookoutstation-emailer
        hostname: lookoutstation-emailer
        networks:
            - lookoutstationnet
        env_file:
            - configs/email.env
        depends_on:
            - api

    frontend:
        build: frontend/
        image: lookoutstation-frontend:latest
        container_name: lookoutstation-frontend
        hostname: lookoutstation-frontend
        networks:
            - lookoutstationnet
        ports:
            - "80:80"
        depends_on:
            - api

    worker-api:
        build: worker-api/
        image: lookoutstation-worker-api:latest
        container_name: lookoutstation-worker-api
        hostname: lookoutstation-worker-api
        networks:
            - lookoutstationnet
        depends_on:
            - redis
            - api

    worker:
        build: worker/
        image: lookoutstation-worker:latest
        container_name: lookoutstation-worker
        hostname: lookoutstation-worker
        networks:
            - lookoutstationnet
        depends_on:
            - redis
